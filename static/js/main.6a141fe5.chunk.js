(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{114:function(e,t,n){e.exports={InputWrap:"Input_InputWrap__1Oh3w",FormGroup:"Input_FormGroup__dHXan"}},116:function(e,t,n){e.exports={Search:"Search_Search__1UqHE",Autocomplete:"Search_Autocomplete__3tVN_",Suggestions:"Search_Suggestions__RZcAg"}},117:function(e,t,n){e.exports={Item:"RoomItem_Item__37k_n",Active:"RoomItem_Active__1neyn",NotRead:"RoomItem_NotRead__13fFl"}},118:function(e,t,n){e.exports={Menu:"Profile_Menu__2mluK",Profile:"Profile_Profile__3agOE",active:"Profile_active__12t4K"}},142:function(e,t,n){e.exports={Container:"ChatBody_Container__35hNP",Preview:"ChatBody_Preview__2RE8A"}},143:function(e,t,n){e.exports={Wrapper:"Layout_Wrapper__ExLx6",App:"Layout_App__2PNTY"}},198:function(e,t,n){e.exports={Spinner:"Spinner_Spinner__3rQJ8"}},208:function(e,t,n){e.exports={Sidebar:"Sidebar_Sidebar__3TdYm"}},210:function(e,t,n){e.exports={Room:"Room_Room__4h6i7"}},213:function(e,t,n){e.exports={Body:"Chat_Body__3gWvU"}},215:function(e,t,n){e.exports={Header:"Header_Header__19x8R"}},219:function(e,t,n){e.exports=n(443)},224:function(e,t,n){},275:function(e,t){},39:function(e,t,n){e.exports={IsOwner:"Message_IsOwner__3zz94",Body:"Message_Body__1owYx",Message:"Message_Message__1VYvD",Status:"Message_Status__MQWiX",Sending:"Message_Sending__2F68P",NotReadBlock:"Message_NotReadBlock__3BasI",Content:"Message_Content__3aCXk",Owner:"Message_Owner__2r8f2",Time:"Message_Time__KLZNs"}},443:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(32),i=n.n(o);n(224),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var s=n(16),c=n(11),l=n(23),u=n(24),m=n(26),d=n(25),p=n(27),h=n(21),f=n.n(h),g=n(36),E=n(8),_=n(195),v=n.n(_).a.create({baseURL:"https://flashy-pilot.glitch.me/"});v.defaults.withCredentials=!0;var S=v,O=function(e){return Object(E.a)({type:"INITIALIZE_SUCCESS"},e)},b=n(196),I=n.n(b),R=null,y=function(e){var t=e.room;return function(e,n){var a,r=n().chat,o=t._id;if(r.rooms.some(function(e,t){return a=t,e._id===o}))return e(w({index:a}));e(T({room:t}))}},C=function(e){var t=e.activeRoomIndex;return function(e,n){var a=n().chat.rooms[t],r=a._id,o=a.notRead;R.emit("read messages",{roomId:r,notRead:o}),e({type:"READ_MESSAGES",activeRoomIndex:t})}},w=function(e){var t=e.index;return function(e){e({type:"OPEN_ROOM",activeRoomIndex:{index:t}.index}),e(j())}},j=function(){return function(e,t){var n=t().chat,a=n.rooms,r=n.activeRoomIndex,o=a[r].messages,i=a[r]._id;e(o?C({activeRoomIndex:r}):function(e){var t=e.roomId;return function(){var e=Object(g.a)(f.a.mark(function e(n,a){var r,o,i;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a().chat.activeRoomIndex,n({type:"FETCH_MESSAGES_START"}),e.next=4,S.get("/messages?id=".concat(t));case 4:o=e.sent,i=o.data.messages,n({type:"FETCH_MESSAGES_SUCCESS",messages:i}),n(C({activeRoomIndex:r}));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}({roomId:i}))}},T=function(e){return{type:"CREATE_ROOM",room:e.room}},A=n(45),x=n.n(A),N=n(100),k=n.n(N),M=n(101),P=n.n(M),L=n(197),U=n.n(L),z=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={open:!0},n.handleClickOpen=function(){n.setState({open:!0})},n.handleClose=function(){n.setState({open:!1})},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.message;return r.a.createElement("div",null,r.a.createElement(k.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(U.a,{id:"alert-dialog-title"},e),r.a.createElement(P.a,null,r.a.createElement(x.a,{onClick:this.handleClose,color:"primary",autoFocus:!0},"Close"))))}}]),t}(r.a.Component),F=n(200),D=n.n(F),H=n(201),q=n.n(H),B=n(202),G=n.n(B),W=function(e){return function(){var t=Object(g.a)(f.a.mark(function t(n){var a,r;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n({type:"FETCH_PROFILE_START"}),t.next=3,S.get("/user?id=".concat(e));case 3:a=t.sent,r=a.data.info,n({type:"FETCH_PROFILE_SUCCESS",info:r});case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},Z=n(199),K=n.n(Z),Y=n(198),X=n.n(Y),J=function(){return r.a.createElement("div",{className:X.a.Spinner},r.a.createElement(K.a,null))},Q=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).handleClose=function(){(0,n.props.close)()},n.handleOpenRoom=function(){var e=n.props,t=e.close,a=e.openRoom;t(),a({userId:n.props.profileInfo.id})},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.fullScreen,n=e.fetching;return r.a.createElement("div",null,r.a.createElement(k.a,{fullScreen:t,open:!0,onClose:this.handleClose,"aria-labelledby":"responsive-dialog-title"},r.a.createElement(D.a,null,n?r.a.createElement(J,null):r.a.createElement(a.Fragment,null,r.a.createElement(q.a,null,"email: ",this.props.profileInfo.email))),!n&&r.a.createElement(P.a,null,r.a.createElement(x.a,{onClick:this.handleClose,color:"primary"},"Close"),r.a.createElement(x.a,{onClick:this.handleOpenRoom,color:"primary",autoFocus:!0},"Chat"))))}}]),t}(r.a.Component),V=Object(c.b)(function(e){return{profileInfo:e.profile.info,fetching:e.profile.fetching}},function(e){return{close:function(){return e({type:"CLOSE_PROFILE"})},openRoom:function(t){var n=t.userId;return e(function(e){var t=e.userId;return function(){var e=Object(g.a)(f.a.mark(function e(n){var a,r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n({type:"FETCH_ROOM_START"}),e.next=3,S.get("/room?user=".concat(t));case 3:a=e.sent,r=a.data.room,n({type:"FETCH_ROOM_SUCCESS"}),n(y({room:r}));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}({userId:n}))}}})(G()()(Q)),$=n(449),ee=n(453),te=n(446),ne=n(450),ae=n(444),re=n(447),oe=function(e){var t={},n=e.email,a=e.password,r=e.eqpassword;return n?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(e.email)||(t.email="Invalid email address"):t.email="Required",a?a.length<6&&(t.password="Must be 6 characters or more!"):t.password="Required",void 0===r||r?a!==r&&(t.eqpassword="Must be equal to password!"):t.eqpassword="Required",t},ie=n(452),se=n(74),ce=n.n(se),le=n(445),ue=n(111),me=n(448),de=n(137),pe=n.n(de),he=n(139),fe=n.n(he),ge=n(82),Ee=n.n(ge),_e=n(138),ve=n.n(_e),Se=n(114),Oe=n.n(Se),be=function(e){var t=e.input,n=e.label,a=e.meta,o=a.touched,i=a.error,s=Object(ue.a)(e,["input","label","meta"]),c=o&&!!i;return r.a.createElement(pe.a,{className:Oe.a.FormGroup,error:c,"aria-describedby":"component-error-text"},r.a.createElement(ve.a,null,n),r.a.createElement(Ee.a,Object.assign({},t,s)),c?r.a.createElement(fe.a,{className:Oe.a.Error},i):null)},Ie=function(e){var t=e.name,n=e.type,a=e.label;return r.a.createElement("div",{className:Oe.a.InputWrap},r.a.createElement(me.a,{name:t,type:n,component:be,label:a}))},Re=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).submit=function(){var e=Object(g.a)(f.a.mark(function e(t){var a,r,o,i;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.email,r=t.password,o=n.props.authType,e.next=4,S.post("/".concat(o),{email:a,password:r});case 4:if("ERROR"!==(i=e.sent).data.status){e.next=9;break}i.data.errors.map(function(e){throw new ae.a(e)}),e.next=10;break;case 9:return e.abrupt("return",i.data.payload);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(){var e=this.props,t=e.initialized,n=e.authType,a=e.logout,r=e.history;t&&r.push("/"),"logout"===n&&a(function(){r.replace("/login")})}},{key:"render",value:function(){var e=this.props,t=e.error,n=e.handleSubmit,a=e.submitting,o="login"===e.authType;return r.a.createElement("div",{className:ce.a.Auth},t&&r.a.createElement("p",{className:ce.a.Error},t),r.a.createElement("form",{onSubmit:n(this.submit),autoComplete:"off"},r.a.createElement(Ie,{name:"email",type:"email",label:"Email"}),r.a.createElement(Ie,{name:"password",type:"password",label:"Password"}),o?null:r.a.createElement(Ie,{name:"eqpassword",type:"password",label:"Repeat password"}),r.a.createElement("div",{className:ce.a.Buttons},r.a.createElement(x.a,{variant:"contained",type:"submit",color:"primary",disabled:a},o?"Log In":"Sign In"),o?r.a.createElement(le.a,{to:"/signin",className:ce.a.Switch},"Sign In"):r.a.createElement(le.a,{to:"/login",className:ce.a.Switch},"Log In"))))}}]),t}(a.Component),ye=Object(re.a)({form:"auth",validate:oe,onSubmitSuccess:function(e,t){t(O(e))}})(Object(ie.a)(Object(c.b)(function(e){return{initialized:e.auth.initialized}},function(e){return{logout:function(t){return e(function(e){return function(){var t=Object(g.a)(f.a.mark(function t(n){return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n({type:"LOGOUT_START"}),S.get("/logout"),e(),n({type:"LOGOUT_SUCCESS"});case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}(t))}}})(Re))),Ce=n(217),we=n(206),je=n.n(we),Te=n(98),Ae=n.n(Te),xe=n(207),Ne=n.n(xe),ke=n(116),Me=n.n(ke);var Pe=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={suggestions:[],loading:!1},n.fetchSuggestions=function(){var e=Object(g.a)(f.a.mark(function e(t){var a,r,o;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.target.value){e.next=3;break}return e.abrupt("return");case 3:return n.setState({loading:!0}),e.next=6,S.get("/users?q=".concat(a));case 6:r=e.sent,o=r.data.suggestions,n.setState({suggestions:o,loading:!1});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.handleChange=function(e,t){if(e){var a=e.id;n.props.fetchUserProfile(a)}t.clearSelection()},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:Me.a.Search},r.a.createElement(Ce.a,{onChange:this.handleChange,itemToString:function(e){return e?e.label:""}},function(t){var n=t.getInputProps,a=t.getItemProps,o=t.getMenuProps,i=t.highlightedIndex,s=t.isOpen,c=t.selectedItem;return r.a.createElement("div",{className:Me.a.Autocomplete},function(e){var t=e.InputProps,n=(e.classes,e.ref),a=Object(ue.a)(e,["InputProps","classes","ref"]);return r.a.createElement(je.a,Object.assign({InputProps:Object(E.a)({inputRef:n},t)},a))}({fullWidth:!0,InputProps:n({placeholder:"Search...",onChange:e.fetchSuggestions})}),r.a.createElement("div",o(),s?r.a.createElement(Ae.a,{square:!0,className:Me.a.Suggestions},e.state.loading&&!e.state.suggestions.length?"Loading...":e.state.suggestions.map(function(e,t){return function(e){var t=e.suggestion,n=e.index,a=e.itemProps,o=e.highlightedIndex===n;return r.a.createElement(Ne.a,Object.assign({},a,{key:t.id,selected:o,component:"div"}),t.label)}({suggestion:e,index:t,itemProps:a({item:e}),highlightedIndex:i,selectedItem:c})})):null))}))}}]),t}(r.a.Component),Le=Object(c.b)(null,function(e){return{fetchUserProfile:function(t){return e(W(t))}}})(Pe),Ue=n(117),ze=n.n(Ue),Fe=function(e){var t=e.roomName,n=e.click,a=e.active,o=e.notRead,i=[ze.a.Item];return a&&i.push(ze.a.Active),r.a.createElement("div",{className:i.join(" "),onClick:n},r.a.createElement("p",null,t),o&&o.length?r.a.createElement("span",{className:ze.a.NotRead},o.length):null)},De=Object(c.b)(function(e){return{loading:e.chat.roomsLoading,rooms:e.chat.rooms,activeRoomIndex:e.chat.activeRoomIndex}},function(e){return{openRoom:function(t){var n=t.index;return e(w({index:n}))}}})(function(e){var t=e.loading,n=e.rooms,o=e.openRoom,i=e.activeRoomIndex,s=n.map(function(e,t){var n=e.roomType,a=e.users,s=e.notRead,c="";return"dialog"===n&&(c=a.filter(function(e){return!e.owner})[0].email),r.a.createElement(Fe,{active:i===t,key:t,roomName:c,notRead:s,click:function(){return o({index:t})}})});return t&&(s=r.a.createElement(J,null)),r.a.createElement(a.Fragment,null,s)}),He=n(208),qe=n.n(He),Be=function(){return r.a.createElement("div",{className:qe.a.Sidebar},r.a.createElement(Le,null),r.a.createElement(De,null))},Ge=n(39),We=n.n(Ge),Ze=n(209),Ke=n.n(Ze),Ye=function(e){var t=e.data,n=e.sameUser,a=e.notRead,o=[We.a.Message];t.owner.owner&&o.push(We.a.IsOwner),a&&o.push(We.a.NotReadBlock);var i=[We.a.Status];switch(t.status){case"not-read":i.push(We.a.NotRead);break;case"sending":i.push(We.a.Sending);break;default:i=null}return r.a.createElement("div",{className:o.join(" ")},!n&&r.a.createElement("div",{className:We.a.Owner},r.a.createElement("p",null,t.owner.email)),r.a.createElement("div",{className:We.a.Body},t.owner.owner&&i?r.a.createElement("span",{className:i.join(" ")}):null,r.a.createElement("div",{className:We.a.Content},t.content),r.a.createElement("p",{className:We.a.Time},Ke()(t.createdAt).format("HH:mm:ss"))))},Xe=n(210),Je=n.n(Xe),Qe=(n(433),n(211)),Ve=n.n(Qe),$e=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).scrolledUp=!1,n.handleScrolledToTop=function(){n.scrolledUp=!0},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(){this.roomBody.scrollTop=this.roomBody.scrollHeight}},{key:"render",value:function(){var e=this,t=this.props,n=t.loading,a=t.messagesLoading,o=t.messages,i=void 0===o?[]:o,s=t.notRead,c=void 0===s?[]:s;return r.a.createElement(Ve.a,{containerRef:function(t){return e.roomBody=t},className:Je.a.Room,onScrollUp:this.handleScrolledToTop},n||a?r.a.createElement(J,null):null,i.map(function(e,t){var n=!1;return t>0&&(i[t-1].owner._id===e.owner._id||i[t-1].owner.owner===e.owner.owner)&&(n=!0),console.log(c.includes(e._id)),r.a.createElement(Ye,{key:e._id||e.uniqId,notRead:c.includes(e._id),sameUser:n,data:e})}))}}]),t}(a.Component),et=Object(c.b)(function(e){return{loading:e.chat.roomLoading,messagesLoading:e.chat.messagesLoading,messages:e.chat.rooms[e.chat.activeRoomIndex].messages,notRead:e.chat.rooms[e.chat.activeRoomIndex].notRead}})($e),tt=n(84),nt=n.n(tt),at=n(218),rt=n(212),ot=n.n(rt),it=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={message:""},n.handleChange=function(e){n.setState({message:e.target.value})},n.handleEnterPress=function(e){"Enter"!==e.key||e.ctrlKey||(e.preventDefault(),n.handleSendMessage())},n.handleCtrlEnterPress=function(e){"Enter"===e.key&&e.ctrlKey&&(e.preventDefault(),n.setState(function(e){return Object(E.a)({},e,{message:e.message+"\n"})}))},n.handleSendMessage=function(){if(n.state.message){var e={type:"text",content:n.state.message,createdAt:new Date,status:"sending"};n.props.send({uniqId:ot()(),message:e}),n.setState({message:""})}},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:nt.a.Container},r.a.createElement("div",{className:nt.a.InputWrapper},r.a.createElement(at.a,{placeholder:"Type here...",onChange:this.handleChange,className:nt.a.Input,value:this.state.message,onKeyUp:this.handleCtrlEnterPress,onKeyPress:this.handleEnterPress}),this.state.message?r.a.createElement("button",{className:nt.a.Button,onClick:this.handleSendMessage},"Send"):null))}}]),t}(a.Component),st=Object(c.b)(null,function(e){return{send:function(t){var n=t.message,a=t.uniqId;return e(function(e){var t=e.uniqId,n=e.message;return function(e,a){var r=a(),o=r.chat.activeRoomIndex,i=r.auth,s=i.email,c=i.avatar,l=r.chat.rooms[o]._id;n.owner={email:s,avatar:c,owner:!0},e(function(e){var t=e.uniqId;return{type:"SEND_MESSAGE_START",message:e.message,uniqId:t}}({uniqId:t,message:n})),R.emit("message",{uniqId:t,message:Object(E.a)({},n,{room:l})})}}({message:n,uniqId:a}))}}})(it),ct=n(142),lt=n.n(ct),ut=Object(c.b)(function(e){return{activeRoomIndex:e.chat.activeRoomIndex}})(function(e){var t=e.activeRoomIndex;return r.a.createElement("div",{className:lt.a.Container},void 0!==t?r.a.createElement(a.Fragment,null,r.a.createElement(et,null),r.a.createElement(st,null)):r.a.createElement("p",{className:lt.a.Preview},"Please select a chat to start messaging"))}),mt=n(213),dt=n.n(mt),pt=function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.fetchUserRooms()}},{key:"componentDidUpdate",value:function(){this.props.failed&&this.props.history.replace("/login")}},{key:"render",value:function(){return r.a.createElement("div",{className:dt.a.Body},r.a.createElement(Be,null),r.a.createElement(ut,null))}}]),t}(a.Component),ht=Object(ie.a)(Object(c.b)(function(e){return{failed:e.auth.failed}},function(e){return{fetchUserRooms:function(){return e(function(){var e=Object(g.a)(f.a.mark(function e(t,n){var a,r,o,i;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:"FETCH_ROOMS_START"}),a=n().auth.notReadMessages,r={},a&&a.forEach(function(e){var t=r[e.roomId];t?t.push(e.messageId):r[e.roomId]=[e.messageId]}),e.next=6,S.get("/rooms");case 6:o=e.sent,(i=o.data.rooms).forEach(function(e){e._id in r&&(e.notRead=r[e._id])}),t({type:"FETCH_ROOMS_SUCCESS",rooms:{rooms:i}.rooms});case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}())}}})(pt)),ft=n(143),gt=n.n(ft),Et=n(118),_t=n.n(Et),vt=n(214),St=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={show:!1},n.handleClick=function(){n.setState({show:!0})},n.handleClickOutside=function(){n.setState({show:!1})},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.email;return r.a.createElement("div",{className:_t.a.Profile},r.a.createElement("p",{onClick:this.handleClick,className:this.state.show?_t.a.active:null},e),this.state.show?r.a.createElement("ul",{className:_t.a.Menu},r.a.createElement("li",null,r.a.createElement(le.a,{to:"/logout"},"logout"))):null)}}]),t}(a.Component),Ot=Object(c.b)(function(e){return{email:e.auth.email,avatar:e.auth.avatar,initialized:e.auth.initialized}})(Object(vt.a)(St)),bt=n(215),It=n.n(bt),Rt=Object(c.b)(function(e){return{initializing:e.auth.initializing,initialized:e.auth.initialized}})(function(e){var t=e.initialized;return r.a.createElement("header",{className:It.a.Header},r.a.createElement("h1",null,"Sociable"),t?r.a.createElement(Ot,null):null)}),yt=function(e){return r.a.createElement("div",{className:gt.a.Wrapper},r.a.createElement("div",{className:gt.a.App},r.a.createElement(Rt,null),e.children))},Ct=function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.initialize()}},{key:"componentDidUpdate",value:function(){this.props.initialized&&!this.props.socketInitialized&&this.props.initializeSocket()}},{key:"render",value:function(){var e=this.props,t=e.error,n=e.showPopup,a=e.initialized,o=e.initializing;return r.a.createElement($.a,{basename:"/sociable"},r.a.createElement(yt,null,t?r.a.createElement(z,{error:!0,message:"Initializing error. Server."}):null,n?r.a.createElement(V,null):null,r.a.createElement(ee.a,null,r.a.createElement(te.a,{path:"/",exact:!0,render:function(){return!o&&a?r.a.createElement(ht,null):o||a?r.a.createElement(J,null):r.a.createElement(ne.a,{to:"/login"})}}),r.a.createElement(te.a,{path:"/login",render:function(){return r.a.createElement(ye,{authType:"login"})}}),r.a.createElement(te.a,{path:"/signin",render:function(){return r.a.createElement(ye,{authType:"signin"})}}),r.a.createElement(te.a,{path:"/logout",render:function(){return r.a.createElement(ye,{authType:"logout"})}}),r.a.createElement(te.a,{path:"/",render:function(){return r.a.createElement("h1",null,"404")}}))))}}]),t}(a.Component),wt=Object(c.b)(function(e){var t=e.auth,n=t.email,a=t.avatar,r=t.error,o=t.initialized;return{initializing:t.initializing,initialized:o,socketInitialized:e.chat.socketInitialized,email:n,avatar:a,error:r,showPopup:e.profile.showPopup}},function(e){return{initialize:function(){return e(function(){var e=Object(g.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"INITIALIZE_START"}),S.post("/initialize").then(function(e){if("OK"!==e.data.status)return t({type:"INITIALIZE_FAILED"});t(O(e.data.payload))}).catch(function(e){return t({type:"INITIALIZE_ERROR",error:{error:e}.error})});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}())},initializeSocket:function(){return e(function(e,t){(R=I()("https://flashy-pilot.glitch.me/")).on("connect",function(){e({type:"SOCKET_INIT_SUCCESS"})}),R.on("message was read",function(t){var n=t.messages;e({type:"MESSAGES_WAS_READ",messages:n})}),R.on("message saved",function(t){var n,a=t.uniqId,r=t.message;e({type:"SEND_MESSAGE_SUCCESS",message:(n={uniqId:a,message:r}).message,uniqId:n.uniqId})}),R.on("message",function(n){var a,r=t().chat,o=r.rooms,i=r.activeRoomIndex,s=!1,c=!1,l=n.room;o.forEach(function(e,t){e._id===l._id&&(c=!0,a=t)}),c||(void 0!==o?o.push(l):o=l,a=o.length-1);var u=o[a],m=u.messages;m&&m.push(n),n.owner.owner||(u.notRead?u.notRead.push(n._id):u.notRead=[n._id]),a===i&&(s=!0),e({type:"PUSHED_MESSAGE",rooms:o}),s&&e(C({activeRoomIndex:i}))})})}}})(Ct),jt=n(216),Tt={email:"",avatar:"",notReadMessages:[],initializing:!0,initialized:!1,failed:!1,error:null},At=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGOUT_START":return e;case"LOGOUT_SUCCESS":return Object(E.a)({},Tt,{failed:!0});case"INITIALIZE_START":return Object(E.a)({},e,{initializing:!0});case"INITIALIZE_SUCCESS":var n=t.email,a=t.avatar,r=t.notReadMessages;return Object(E.a)({},e,{email:n,avatar:a,notReadMessages:r,initializing:!1,initialized:!0,failed:!1});case"INITIALIZE_FAILED":return Object(E.a)({},e,{initialized:!1,initializing:!1,failed:!0});case"INITIALIZE_ERROR":return Object(E.a)({},e,{initializing:!1,initialized:!1,error:t.error});default:return e}},xt=n(451),Nt={info:{avatar:null,email:"",id:null,room:null},showPopup:!1,fetching:!1,error:null},kt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Nt,t=arguments.length>1?arguments[1]:void 0,n=t.info,a=t.error;switch(t.type){case"FETCH_PROFILE_START":return Object(E.a)({},e,{fetching:!0,showPopup:!0});case"FETCH_PROFILE_SUCCESS":return Object(E.a)({},e,{fetching:!1,info:n});case"FETCH_PROFILE_ERROR":return Object(E.a)({},e,{fetching:!1,error:a});case"CLOSE_PROFILE":return Object(E.a)({},e,{showPopup:!1});default:return e}},Mt=n(144),Pt=n(29),Lt=n.n(Pt),Ut={rooms:[],activeRoomIndex:void 0,roomsLoading:!1,roomLoading:!1,messagesLoading:!1,socketInitialized:!1},zt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ut,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_ROOM_START":return Object(E.a)({},Lt.a.cloneDeep(e),{roomLoading:!0});case"FETCH_ROOM_SUCCESS":case"FETCH_ROOM_ERROR":return Object(E.a)({},Lt.a.cloneDeep(e),{roomLoading:!1});case"FETCH_ROOMS_START":return Object(E.a)({},Lt.a.cloneDeep(e),{roomsLoading:!0});case"FETCH_ROOMS_SUCCESS":return Object(E.a)({},Lt.a.cloneDeep(e),{roomsLoading:!1,rooms:t.rooms});case"FETCH_ROOMS_ERROR":return Object(E.a)({},Lt.a.cloneDeep(e),{roomsLoading:!1});case"OPEN_ROOM":return Object(E.a)({},Lt.a.cloneDeep(e),{activeRoomIndex:t.activeRoomIndex});case"CREATE_ROOM":return Object(E.a)({},Lt.a.cloneDeep(e),{rooms:[t.room].concat(Object(Mt.a)(e.rooms)),activeRoomIndex:0});case"FETCH_MESSAGES_START":return Object(E.a)({},Lt.a.cloneDeep(e),{messagesLoading:!0});case"FETCH_MESSAGES_SUCCESS":var n=Lt.a.cloneDeep(e);return n.rooms[e.activeRoomIndex].messages=t.messages,n.messagesLoading=!1,n;case"SEND_MESSAGE_START":var a=Lt.a.cloneDeep(e),r=t.message,o=t.uniqId;return r.uniqId=o,a.rooms[e.activeRoomIndex].messages?a.rooms[e.activeRoomIndex].messages.push(r):a.rooms[e.activeRoomIndex].messages=[r],a;case"SEND_MESSAGE_SUCCESS":var i=t.message,s=t.uniqId,c=Lt.a.cloneDeep(e);try{c.rooms.forEach(function(e,t){e.messages&&e.messages.forEach(function(e,n){if(e.uniqId===s)throw i.owner=e.owner,c.rooms[t].messages[n]=i,new Error("break loop")})})}catch(f){if("break loop"!==f.message)throw f}return c;case"SOCKET_INIT_SUCCESS":return Object(E.a)({},e,{socketInitialized:!0});case"PUSHED_MESSAGE":var l=Lt.a.cloneDeep(e),u=Lt.a.cloneDeep(t.rooms);return Object(E.a)({},l,{rooms:Object(Mt.a)(u)});case"READ_MESSAGES":var m=Lt.a.cloneDeep(e),d=t.activeRoomIndex;return m.rooms[d].notRead=[],m;case"MESSAGES_WAS_READ":var p=Lt.a.cloneDeep(e),h=t.messages;return p.rooms.forEach(function(e){e.messages&&e.messages.forEach(function(e){h.includes(e._id)&&(e.status="read")})}),p;default:return e}},Ft=Object(s.c)({auth:At,form:xt.a,profile:kt,chat:zt}),Dt=s.d;window.__MUI_USE_NEXT_TYPOGRAPHY_VARIANTS__=!0;var Ht=Object(s.e)(Ft,Dt(Object(s.a)(jt.a))),qt=r.a.createElement(c.a,{store:Ht},r.a.createElement(wt,null));i.a.render(qt,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},74:function(e,t,n){e.exports={Auth:"Auth_Auth__2bc43",Error:"Auth_Error__2PM-K",Buttons:"Auth_Buttons__3LABR",Switch:"Auth_Switch__3Qum1"}},84:function(e,t,n){e.exports={Container:"MessageInput_Container__2FIuU",Input:"MessageInput_Input__1nz7Z",InputWrapper:"MessageInput_InputWrapper__1erff",Placeholder:"MessageInput_Placeholder__-AMGB"}}},[[219,2,1]]]);
//# sourceMappingURL=main.6a141fe5.chunk.js.map